{% include 'navbar.html' %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flood Risk Prediction | FloodML</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body {
      height: 100%; margin: 0; font-family: 'Inter', sans-serif; overflow: hidden;
    }
    #map {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
    }
    .container-content {
      position: relative; z-index: 1; padding: 40px;
    }
    .search-box {
      display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 30px;
    }
    .form-control {
      border-radius: 12px; height: 48px; width: 300px; padding: 10px 16px;
      border: 2px solid #ccc; transition: all 0.3s ease;
    }
    .form-control:focus {
      border-color: #0077cc; box-shadow: 0 0 10px rgba(0,119,204,0.4);
    }
    .btn-go {
      height: 48px; padding: 0 24px; border-radius: 12px;
      background: linear-gradient(to right,#003366,#0055a5); color: #fff; font-weight:600;
      border: none; transition: all 0.3s ease;
    }
    .main-grid {
      display: grid;
      grid-template-columns: auto auto 1fr auto;
      column-gap: 30px;
      align-items: start;
    }
    .risk-card {
      width: 300px; height: 520px;
      background: rgba(255,255,255,0.9);
      border-radius: 24px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.12);
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      text-align:center;
      padding:30px;
    }
    .risk-card span {
      font-size:3.5rem; font-weight:700;
    }
    .risk-card p {
      font-size:1.5rem; font-weight:500;
    }
    .risk-card.lowest { background:linear-gradient(145deg,#e0fff1,#b6f4d1); color:#056644; }
    .risk-card.low     { background:linear-gradient(145deg,#f0fcd0,#e2ef92); color:#7a6000; }
    .risk-card.moderate{ background:linear-gradient(145deg,#fff0cc,#ffe09c); color:#946d00; }
    .risk-card.high    { background:linear-gradient(145deg,#ffd1d1,#ff9e9e); color:#a10000; }
    .risk-card.extreme { background:linear-gradient(145deg,#ffb3b3,#ff6666); color:#fff; }
    .metrics-column {
      display:flex; flex-direction:column; gap:20px;
    }
    .metric-card {
      width:250px; height:140px;
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(6px);
      border-radius:16px;
      box-shadow:0 10px 25px rgba(0,0,0,0.1);
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      padding:10px;
      text-align:center;
    }
    .metric-title { font-size:1.5rem; color:#333; margin-bottom:6px; }
    .metric-value { font-size:2rem; font-weight:600; color:#111; }
    #pin-label {
      position:absolute; bottom:40px; left:50%; transform:translateX(-50%);
      background:rgba(255,255,255,0.9); padding:8px 16px;
      border-radius:10px; box-shadow:0 6px 12px rgba(0,0,0,0.15);
      z-index:2;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="container-content">
    <div class="search-box">
      <form method="post" id="cityForm" class="d-flex gap-2">
        <input type="text" name="city" class="form-control" placeholder="Enter city name..." value="{{ cityname|replace('Information about ','') }}" required>
        <button type="submit" class="btn-go">Predict</button>
      </form>
    </div>
    <div class="main-grid">
      <!-- Risk Card -->
      <div class="risk-card {% if risk %}{{ risk }}{% endif %}">  
        <h3>Predicted Flood Risk</h3>
        <span>{{ score or '--' }}%</span>
        <p>{{ risk or 'No prediction yet' }}</p>
      </div>

      <!-- Left Metrics -->
      <div class="metrics-column">
        <div class="metric-card"><div class="metric-title">Temperature (°C)</div><div class="metric-value">{{ temp or '--' }}</div></div>
        <div class="metric-card"><div class="metric-title">Humidity</div><div class="metric-value">{{ humidity or '--' }}%</div></div>
        <div class="metric-card"><div class="metric-title">Soil Moisture</div><div class="metric-value">{{ soil_moisture or '--' }}%</div></div>
        <div class="metric-card"><div class="metric-title">Elevation (m)</div><div class="metric-value">{{ elevation or '--' }}</div></div>
      </div>
      
      <!-- Spacer -->
      <div></div>
      <!-- Right Metrics -->
      <div class="metrics-column">
        <div class="metric-card"><div class="metric-title">Rainfall Last 3 Days</div><div class="metric-value">{{ rain_3d or '0' }}</div></div>
        <div class="metric-card"><div class="metric-title">Rain Forecast (48h)</div><div class="metric-value">{{ rain_2d or '--' }}</div></div>
        <div class="metric-card"><div class="metric-title">Rain Probability</div><div class="metric-value">{{ pop or '0' }}%</div></div>
        <div class="metric-card"><div class="metric-title">Drainage Index</div><div class="metric-value">{{ drainage or '--' }}</div></div>
      </div>
    </div>
    {% if pin_city %}<div id="pin-label">Pinned location: {{ pin_city }}</div>{% endif %}
  </div>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([20.5937,78.9629],5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'© OpenStreetMap'}).addTo(map);
    {% if lat and lon %}
      const latVal = {{ lat|safe }};
      const lonVal = {{ lon|safe }};
      L.marker([latVal,lonVal]).addTo(map);
      map.flyTo([latVal, lonVal], 12, { duration: 2 });

    {% endif %}
  </script>
</body>
</html>
